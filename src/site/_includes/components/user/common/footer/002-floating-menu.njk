<aside id="floating-menu">
  <div class="floating-menu-container">
    <button id="menu-toggle" class="menu-button main" title="Menu">
      <!-- grid icon -->
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7" rx="1"></rect>
        <rect x="14" y="3" width="7" height="7" rx="1"></rect>
        <rect x="14" y="14" width="7" height="7" rx="1"></rect>
        <rect x="3" y="14" width="7" height="7" rx="1"></rect>
      </svg>
    </button>

    <nav id="menu-items" class="menu-items hidden">
      <a href="{{ '/' | url }}" class="menu-item">Home</a>
      <button id="recent-posts-btn" class="menu-item">Recent</button>
      <button id="graph-btn" class="menu-item">Graph</button>
      <button id="theme-toggle" class="menu-item">Theme</button>
      <a href="https://github.com/beembarik/mydigitalgarden"
         target="_blank" rel="noopener"
         class="menu-item">GitHub</a>
    </nav>
  </div>

  <!-- RECENT MODAL -->
  <div id="recent-posts-modal" class="modal hidden">
    <div class="modal-content glass">
      <div class="modal-header">
        <h2>Recently Read</h2>
        <button class="close-btn" id="close-recent">&times;</button>
      </div>
      <div id="recent-posts-list" class="modal-body"></div>
    </div>
  </div>

  <!-- GRAPH MODAL -->
  <div id="graph-modal" class="modal hidden">
    <div class="modal-content glass graph-modal-content">
      <div class="modal-header">
        <h2>Global Graph</h2>
        <button class="close-btn" id="close-graph">&times;</button>
      </div>
      <div id="graph-container" class="modal-body graph-body"></div>
    </div>
  </div>
</aside>

<!-- graph libs -->
<script src="https://unpkg.com/force-graph@1.43.1/dist/force-graph.min.js"></script>

<script>
(function() {
  const menuToggle = document.getElementById('menu-toggle');
  const menuItems = document.getElementById('menu-items');
  const themeToggle = document.getElementById('theme-toggle');
  const recentBtn = document.getElementById('recent-posts-btn');
  const graphBtn = document.getElementById('graph-btn');

  const recentModal = document.getElementById('recent-posts-modal');
  const graphModal = document.getElementById('graph-modal');

  const closeRecent = document.getElementById('close-recent');
  const closeGraph = document.getElementById('close-graph');

  let graphLoaded = false;

  // MENU TOGGLE
  menuToggle.addEventListener('click', () => {
    menuItems.classList.toggle('hidden');
    menuToggle.classList.toggle('active');
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('#floating-menu')) {
      menuItems.classList.add('hidden');
      menuToggle.classList.remove('active');
    }
  });

  // THEME
  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('theme-dark');
    document.body.classList.toggle('theme-light');
  });

  // RECENT MODAL
  recentBtn.addEventListener('click', () => {
    recentModal.classList.remove('hidden');
  });

  closeRecent.addEventListener('click', () => {
    recentModal.classList.add('hidden');
  });

  // GRAPH MODAL
  graphBtn.addEventListener('click', () => {
    graphModal.classList.remove('hidden');

    if (!graphLoaded) {
      setTimeout(initGraph, 100);
      graphLoaded = true;
    }
  });

  closeGraph.addEventListener('click', () => {
    graphModal.classList.add('hidden');
  });

  function initGraph() {
    const container = document.getElementById('graph-container');

    fetch('/graph.json')
      .then(res => res.json())
      .then(data => {
        container.innerHTML = '';

        const el = document.createElement('div');
        el.style.width = '100%';
        el.style.height = '100%';
        container.appendChild(el);

        ForceGraph()(el)
          .graphData(data)
          .nodeAutoColorBy('group')
          .linkOpacity(0.3)
          .onNodeClick(node => {
            if (node.url) window.location.href = node.url;
          });
      })
      .catch(() => {
        container.innerHTML =
          '<p style="text-align:center;padding:2rem;">Graph not available</p>';
      });
  }
})();
</script>